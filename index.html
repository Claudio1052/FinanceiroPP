<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Dízimos e Ofertas - Verbo da Vida</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* PALETA DE CORES ATUALIZADA - TEMA AZUL PROFISSIONAL PARA IGREJA */
        :root { 
            --primary: #1a4b8c; 
            --primary-light: #2a6fd6; 
            --secondary: #f9c80e; 
            --success: #28a745; 
            --danger: #dc3545; 
            --light: #f8f9fa; 
            --dark: #343a40; 
            --gray: #6c757d; 
            --border: #dee2e6; 
            --accent: #17a2b8;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background-color: #f8f9fa; color: var(--dark); line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* HEADER ATUALIZADO */
        header { 
            background: linear-gradient(135deg, var(--primary), var(--primary-light)); 
            color: white; 
            padding: 20px 0; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
            margin-bottom: 30px; 
            border-bottom: 4px solid var(--secondary);
        }
        .header-content { display: flex; justify-content: space-between; align-items: center; }
        .logo { display: flex; align-items: center; gap: 15px; }
        .logo i { font-size: 2rem; }
        .logo h1 { font-size: 1.8rem; font-weight: 600; }
        .church-selector { display: flex; gap: 10px; }
        .church-btn { 
            padding: 8px 15px; 
            background: rgba(255,255,255,0.2); 
            border-radius: 5px; 
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        .church-btn.active { 
            background: var(--secondary); 
            color: var(--dark); 
            font-weight: 600;
        }
        
        /* CARDS DO DASHBOARD */
        .dashboard-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { 
            background: white; 
            border-radius: 10px; 
            padding: 20px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); 
            transition: transform 0.3s ease; 
            border-top: 4px solid var(--primary);
        }
        .card:hover { transform: translateY(-5px); }
        .card h3 { font-size: 0.9rem; color: var(--gray); margin-bottom: 10px; }
        .card .value { font-size: 1.8rem; font-weight: 700; }
        .card.entrada .value { color: var(--success); }
        .card.saida .value { color: var(--danger); }
        .card.total .value { color: var(--primary); }
        .card.dizimos { border-top-color: var(--success); }
        .card.ofertas { border-top-color: var(--accent); }
        
        /* SEÇÃO DE FILTROS */
        .filters { 
            background: white; 
            border-radius: 10px; 
            padding: 20px; 
            margin-bottom: 30px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.05); 
            border-left: 4px solid var(--primary);
        }
        .filter-row { display: flex; flex-wrap: wrap; gap: 15px; margin-bottom: 15px; }
        .filter-group { flex: 1; min-width: 200px; }
        .filter-group label { display: block; margin-bottom: 5px; font-weight: 500; color: var(--gray); }
        .filter-group input, .filter-group select { width: 100%; padding: 10px; border: 1px solid var(--border); border-radius: 5px; font-size: 1rem; }
        .filter-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px; }
        
        /* BOTÕES */
        button { 
            padding: 10px 20px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-weight: 500; 
            transition: all 0.3s ease; 
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-primary:hover { background-color: var(--primary-light); }
        .btn-secondary { background-color: var(--light); color: var(--dark); }
        .btn-secondary:hover { background-color: #e0e0e0; }
        .btn-success { background-color: var(--success); color: white; }
        .btn-success:hover { background-color: #218838; }
        .btn-church { background-color: var(--accent); color: white; }
        .btn-church:hover { background-color: #138496; }
        
        /* TABELA DE TRANSAÇÕES */
        .transactions { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .transactions-header { 
            padding: 15px 20px; 
            background-color: var(--light); 
            border-bottom: 1px solid var(--border); 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }
        .transactions-header h2 { font-size: 1.2rem; font-weight: 600; }
        .transactions-count { color: var(--gray); font-size: 0.9rem; }
        table { width: 100%; border-collapse: collapse; }
        thead { background-color: var(--light); }
        th { padding: 15px 20px; text-align: left; font-weight: 600; color: var(--gray); border-bottom: 1px solid var(--border); }
        td { padding: 15px 20px; border-bottom: 1px solid var(--border); }
        tbody tr:hover { background-color: rgba(26, 75, 140, 0.05); }
        
        /* BADGES E INDICADORES */
        .transaction-type { display: inline-block; padding: 5px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
        .entrada-badge { background-color: rgba(40, 167, 69, 0.1); color: var(--success); }
        .saida-badge { background-color: rgba(220, 53, 69, 0.1); color: var(--danger); }
        .amount { font-weight: 600; }
        .entrada-amount { color: var(--success); }
        .saida-amount { color: var(--danger); }
        
        .payment-method { 
            display: inline-block; 
            padding: 4px 8px; 
            border-radius: 12px; 
            font-size: 0.7rem; 
            font-weight: 600; 
            background-color: rgba(26, 75, 140, 0.1); 
            color: var(--primary); 
        }
        
        .situacao-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .situacao-aprovado { background-color: rgba(40, 167, 69, 0.1); color: var(--success); }
        .situacao-pendente { background-color: rgba(255, 193, 7, 0.1); color: #ffc107; }
        .situacao-cancelado { background-color: rgba(220, 53, 69, 0.1); color: var(--danger); }
        
        /* NOVOS ESTILOS PARA AS COLUNAS ESPECÍFICAS */
        .id-transacao, .codigo-operacao, .chave-seguranca {
            font-size: 0.8rem;
            font-family: monospace;
            color: var(--gray);
        }
        
        .tipo-doacao-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .dizimo-badge { background-color: rgba(40, 167, 69, 0.1); color: var(--success); }
        .oferta-badge { background-color: rgba(23, 162, 184, 0.1); color: var(--accent); }
        .outro-badge { background-color: rgba(108, 117, 125, 0.1); color: var(--gray); }
        
        /* ESTILOS DE ESTADO */
        .loading { text-align: center; padding: 40px; color: var(--gray); }
        .loading i { font-size: 2rem; margin-bottom: 10px; }
        .error { background-color: rgba(220, 53, 69, 0.1); color: var(--danger); padding: 15px; border-radius: 5px; margin-bottom: 20px; border-left: 4px solid var(--danger); }
        .success { background-color: rgba(40, 167, 69, 0.1); color: var(--success); padding: 15px; border-radius: 5px; margin-bottom: 20px; border-left: 4px solid var(--success); }
        .connection-status { display: flex; align-items: center; gap: 10px; padding: 10px 15px; border-radius: 5px; margin-bottom: 20px; }
        .status-connected { background-color: rgba(40, 167, 69, 0.1); color: var(--success); border-left: 4px solid var(--success); }
        .status-disconnected { background-color: rgba(220, 53, 69, 0.1); color: var(--danger); border-left: 4px solid var(--danger); }
        
        .filtered-totals-info {
            background-color: rgba(249, 200, 14, 0.1);
            color: #8a6d00;
            padding: 10px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid var(--secondary);
            font-size: 0.9rem;
        }
        
        footer { 
            text-align: center; 
            margin-top: 40px; 
            padding: 20px; 
            color: var(--gray); 
            font-size: 0.9rem; 
            border-top: 1px solid var(--border);
        }
        
        /* RESPONSIVIDADE */
        @media (max-width: 768px) { 
            .header-content { flex-direction: column; gap: 15px; } 
            .church-selector { width: 100%; justify-content: center; }
            .dashboard-cards { grid-template-columns: 1fr; } 
            table { display: block; overflow-x: auto; } 
            .filter-actions { justify-content: center; }
            .filter-actions button { flex: 1; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-church"></i>
                    <div>
                        <h1>Controle de Dízimos e Ofertas</h1>
                        <p>Verbo da Vida - Sistema Integrado</p>
                    </div>
                </div>
                <div class="church-selector">
                    <div class="church-btn active" data-church="todas">Todas as Igrejas</div>
                    <div class="church-btn" data-church="inga">Verbo da Vida Ingá</div>
                    <div class="church-btn" data-church="zona-leste">Verbo da Vida Zona Leste</div>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="connection-status status-connected">
            <i class="fas fa-check-circle"></i>
            <span>Conectando ao sistema...</span>
        </div>
        
        <div class="dashboard-cards">
            <div class="card entrada">
                <h3>Total de Entradas</h3>
                <div class="value">R$ 0,00</div>
                <p>Carregando...</p>
            </div>
            <div class="card saida">
                <h3>Total de Saídas</h3>
                <div class="value">R$ 0,00</div>
                <p>Carregando...</p>
            </div>
            <div class="card total">
                <h3>Saldo Geral</h3>
                <div class="value">R$ 0,00</div>
                <p>Carregando...</p>
            </div>
            <div class="card dizimos">
                <h3>Total de Dízimos</h3>
                <div class="value">R$ 0,00</div>
                <p>Carregando...</p>
            </div>
            <div class="card ofertas">
                <h3>Total de Ofertas</h3>
                <div class="value">R$ 0,00</div>
                <p>Carregando...</p>
            </div>
        </div>
        
        <div class="filters">
            <div class="filter-row">
                <div class="filter-group">
                    <label for="data-inicio">Data Início</label>
                    <input type="date" id="data-inicio">
                </div>
                <div class="filter-group">
                    <label for="data-fim">Data Fim</label>
                    <input type="date" id="data-fim">
                </div>
                <div class="filter-group">
                    <label for="tipo">Tipo</label>
                    <select id="tipo">
                        <option value="">Todos</option>
                        <option value="credit">Entrada</option>
                        <option value="debit">Saída</option>
                    </select>
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="doador">Nome do Doador</label>
                    <input type="text" id="doador" placeholder="Digite o nome do doador">
                </div>
                <div class="filter-group">
                    <label for="tipo-doacao">Tipo de Doação</label>
                    <select id="tipo-doacao">
                        <option value="">Todos</option>
                        <option value="dizimo">Dízimo</option>
                        <option value="oferta">Oferta</option>
                        <option value="outro">Outro</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="valor">Valor Mínimo</label>
                    <input type="number" id="valor" placeholder="Digite o valor mínimo" step="0.01">
                </div>
            </div>
            <div class="filter-row">
                <div class="filter-group">
                    <label for="status">Status</label>
                    <select id="status">
                        <option value="">Todos</option>
                        <option value="approved">Aprovado</option>
                        <option value="pending">Pendente</option>
                        <option value="cancelled">Cancelado</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="metodo-pagamento">Método de Pagamento</label>
                    <select id="metodo-pagamento">
                        <option value="">Todos</option>
                        <option value="PIX">PIX</option>
                        <option value="Cartão">Cartão</option>
                        <option value="Dinheiro">Dinheiro</option>
                        <option value="Transferência">Transferência</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="igreja">Igreja</label>
                    <select id="igreja">
                        <option value="">Todas</option>
                        <option value="inga">Verbo da Vida Ingá</option>
                        <option value="zona-leste">Verbo da Vida Zona Leste</option>
                    </select>
                </div>
            </div>
            <div class="filter-actions">
                <button class="btn-secondary" id="limpar-filtros">
                    <i class="fas fa-eraser"></i> Limpar Filtros
                </button>
                <button class="btn-primary" id="aplicar-filtros">
                    <i class="fas fa-filter"></i> Aplicar Filtros
                </button>
                <button class="btn-success" id="atualizar-dados">
                    <i class="fas fa-sync-alt"></i> Atualizar Dados
                </button>
                <button class="btn-church" id="exportar-dados">
                    <i class="fas fa-file-export"></i> Exportar
                </button>
            </div>
        </div>
        
        <div class="filtered-totals-info" style="display: none;">
            <i class="fas fa-info-circle"></i>
            <span id="filtered-totals-text">Totais calculados com base nos filtros aplicados</span>
        </div>
        
        <div class="transactions">
            <div class="transactions-header">
                <h2>Registro de Doações</h2>
                <div class="transactions-count">Carregando doações...</div>
            </div>
            <div class="loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Carregando dados do sistema...</p>
            </div>
            <table style="display: none;">
                <thead>
                    <tr>
                        <th>Situação</th>
                        <th>Valor</th>
                        <th>Data/Hora</th>
                        <th>Doador</th>
                        <th>Tipo</th>
                        <th>Igreja</th>
                        <th>Método Pagamento</th>
                        <th>ID Transação</th>
                        <th>Observações</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
    
    <footer>
        <div class="container">
            <p>Sistema de Controle de Dízimos e Ofertas - Verbo da Vida &copy; 2023</p>
            <p>Desenvolvido para as igrejas Verbo da Vida Ingá e Verbo da Vida Zona Leste</p>
        </div>
    </footer>

    <script>
        // Dados de exemplo para demonstração
        const doacoesExemplo = [
            {
                id: '1',
                situacao: 'approved',
                valor: 150.00,
                dataHora: '15/10/2023 - 09:30:45',
                doador: 'João Silva',
                tipo: 'dizimo',
                igreja: 'inga',
                metodoPagamento: 'PIX',
                descricao: 'Dízimo mensal',
                observacoes: 'Membro desde 2018'
            },
            {
                id: '2',
                situacao: 'approved',
                valor: 50.00,
                dataHora: '15/10/2023 - 10:15:22',
                doador: 'Maria Santos',
                tipo: 'oferta',
                igreja: 'zona-leste',
                metodoPagamento: 'Dinheiro',
                descricao: 'Oferta de gratidão',
                observacoes: 'Primeira visita'
            },
            {
                id: '3',
                situacao: 'pending',
                valor: 200.00,
                dataHora: '14/10/2023 - 14:20:33',
                doador: 'Pedro Oliveira',
                tipo: 'dizimo',
                igreja: 'inga',
                metodoPagamento: 'Cartão',
                descricao: 'Dízimo mensal',
                observacoes: ''
            },
            {
                id: '4',
                situacao: 'approved',
                valor: 75.00,
                dataHora: '14/10/2023 - 16:45:12',
                doador: 'Ana Costa',
                tipo: 'oferta',
                igreja: 'zona-leste',
                metodoPagamento: 'PIX',
                descricao: 'Oferta missionária',
                observacoes: 'Doação para missões'
            },
            {
                id: '5',
                situacao: 'approved',
                valor: 100.00,
                dataHora: '13/10/2023 - 11:30:15',
                doador: 'Carlos Ferreira',
                tipo: 'dizimo',
                igreja: 'inga',
                metodoPagamento: 'Transferência',
                descricao: 'Dízimo mensal',
                observacoes: ''
            },
            {
                id: '6',
                situacao: 'cancelled',
                valor: 30.00,
                dataHora: '12/10/2023 - 19:20:45',
                doador: 'Fernanda Lima',
                tipo: 'outro',
                igreja: 'zona-leste',
                metodoPagamento: 'Dinheiro',
                descricao: 'Doação especial',
                observacoes: 'Doação cancelada a pedido'
            }
        ];

        // Elementos DOM
        const aplicarFiltrosBtn = document.getElementById('aplicar-filtros');
        const limparFiltrosBtn = document.getElementById('limpar-filtros');
        const atualizarDadosBtn = document.getElementById('atualizar-dados');
        const exportarDadosBtn = document.getElementById('exportar-dados');
        const dataInicioInput = document.getElementById('data-inicio');
        const dataFimInput = document.getElementById('data-fim');
        const tipoSelect = document.getElementById('tipo');
        const doadorInput = document.getElementById('doador');
        const tipoDoacaoSelect = document.getElementById('tipo-doacao');
        const valorInput = document.getElementById('valor');
        const statusSelect = document.getElementById('status');
        const metodoPagamentoSelect = document.getElementById('metodo-pagamento');
        const igrejaSelect = document.getElementById('igreja');
        const transactionsCount = document.querySelector('.transactions-count');
        const loadingDiv = document.querySelector('.loading');
        const table = document.querySelector('table');
        const tbody = document.querySelector('tbody');
        const connectionStatus = document.querySelector('.connection-status');
        const churchButtons = document.querySelectorAll('.church-btn');
        
        // Elementos para os totais filtrados
        const filteredTotalsInfo = document.querySelector('.filtered-totals-info');
        const filteredTotalsText = document.getElementById('filtered-totals-text');

        let allTransactions = [];
        let filteredTransactions = [];
        let igrejaSelecionada = 'todas';

        // Formatar valor para Real brasileiro
        function formatarValor(valor) {
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(valor);
        }

        // Inicializar datas
        function inicializarDatas() {
            const hoje = new Date();
            const primeiroDiaMes = new Date(hoje.getFullYear(), hoje.getMonth(), 1);
            
            dataInicioInput.value = primeiroDiaMes.toISOString().split('T')[0];
            dataFimInput.value = hoje.toISOString().split('T')[0];
        }

        // Carregar dados iniciais
        function carregarDadosIniciais() {
            loadingDiv.style.display = 'block';
            table.style.display = 'none';
            
            // Simular carregamento de dados
            setTimeout(() => {
                allTransactions = [...doacoesExemplo];
                
                connectionStatus.innerHTML = '<i class="fas fa-check-circle"></i><span>Sistema Conectado - Dados Carregados</span>';
                connectionStatus.className = 'connection-status status-connected';
                
                aplicarFiltros();
                atualizarContadores();
                loadingDiv.style.display = 'none';
                table.style.display = 'table';
            }, 1500);
        }

        // Atualizar contadores
        function atualizarContadores() {
            const transacoesParaCalcular = igrejaSelecionada === 'todas' 
                ? allTransactions 
                : allTransactions.filter(t => t.igreja === igrejaSelecionada);
                
            const entradas = transacoesParaCalcular.filter(t => t.situacao !== 'cancelled').reduce((sum, t) => sum + t.valor, 0);
            const saidas = 0; // Em um sistema real, seriam despesas da igreja
            
            const dizimos = transacoesParaCalcular
                .filter(t => t.tipo === 'dizimo' && t.situacao !== 'cancelled')
                .reduce((sum, t) => sum + t.valor, 0);
                
            const ofertas = transacoesParaCalcular
                .filter(t => t.tipo === 'oferta' && t.situacao !== 'cancelled')
                .reduce((sum, t) => sum + t.valor, 0);
            
            document.querySelector('.card.entrada .value').textContent = formatarValor(entradas);
            document.querySelector('.card.saida .value').textContent = formatarValor(saidas);
            document.querySelector('.card.total .value').textContent = formatarValor(entradas - saidas);
            document.querySelector('.card.dizimos .value').textContent = formatarValor(dizimos);
            document.querySelector('.card.ofertas .value').textContent = formatarValor(ofertas);
            
            // Atualizar textos
            document.querySelector('.card.entrada p').textContent = 'Total de Entradas';
            document.querySelector('.card.saida p').textContent = 'Total de Saídas';
            document.querySelector('.card.total p').textContent = 'Saldo Disponível';
            document.querySelector('.card.dizimos p').textContent = 'Total de Dízimos';
            document.querySelector('.card.ofertas p').textContent = 'Total de Ofertas';
            
            // Esconder identificador de totais filtrados
            filteredTotalsInfo.style.display = 'none';
        }

        // Atualizar totais com base nas transações filtradas
        function atualizarTotaisFiltrados(transacoes) {
            const entradas = transacoes.filter(t => t.situacao !== 'cancelled').reduce((sum, t) => sum + t.valor, 0);
            const saidas = 0;
            
            const dizimos = transacoes
                .filter(t => t.tipo === 'dizimo' && t.situacao !== 'cancelled')
                .reduce((sum, t) => sum + t.valor, 0);
                
            const ofertas = transacoes
                .filter(t => t.tipo === 'oferta' && t.situacao !== 'cancelled')
                .reduce((sum, t) => sum + t.valor, 0);
            
            document.querySelector('.card.entrada .value').textContent = formatarValor(entradas);
            document.querySelector('.card.saida .value').textContent = formatarValor(saidas);
            document.querySelector('.card.total .value').textContent = formatarValor(entradas - saidas);
            document.querySelector('.card.dizimos .value').textContent = formatarValor(dizimos);
            document.querySelector('.card.ofertas .value').textContent = formatarValor(ofertas);
            
            // Atualizar textos informativos
            document.querySelector('.card.entrada p').textContent = 'Entradas (filtradas)';
            document.querySelector('.card.saida p').textContent = 'Saídas (filtradas)';
            document.querySelector('.card.total p').textContent = 'Saldo (filtrado)';
            document.querySelector('.card.dizimos p').textContent = 'Dízimos (filtrados)';
            document.querySelector('.card.ofertas p').textContent = 'Ofertas (filtradas)';
            
            // Mostrar identificador de totais filtrados
            filteredTotalsInfo.style.display = 'block';
            filteredTotalsText.textContent = `Totais calculados com base nos filtros aplicados: ${transacoes.length} doações`;
        }

        // Renderizar transações
        function renderizarTransacoes(transacoes) {
            tbody.innerHTML = '';
            
            if (transacoes.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 40px;">Nenhuma doação encontrada com os filtros aplicados</td></tr>';
                transactionsCount.textContent = 'Mostrando 0 de 0 doações';
                return;
            }
            
            transacoes.forEach(transacao => {
                const tr = document.createElement('tr');
                
                // Determinar badge de situação
                let situacaoTexto = '';
                let situacaoClass = '';
                if (transacao.situacao === 'approved') {
                    situacaoTexto = 'Aprovado';
                    situacaoClass = 'situacao-aprovado';
                } else if (transacao.situacao === 'pending') {
                    situacaoTexto = 'Pendente';
                    situacaoClass = 'situacao-pendente';
                } else if (transacao.situacao === 'cancelled') {
                    situacaoTexto = 'Cancelado';
                    situacaoClass = 'situacao-cancelado';
                }
                
                // Determinar badge de tipo de doação
                let tipoTexto = '';
                let tipoClass = '';
                if (transacao.tipo === 'dizimo') {
                    tipoTexto = 'Dízimo';
                    tipoClass = 'dizimo-badge';
                } else if (transacao.tipo === 'oferta') {
                    tipoTexto = 'Oferta';
                    tipoClass = 'oferta-badge';
                } else {
                    tipoTexto = 'Outro';
                    tipoClass = 'outro-badge';
                }
                
                // Determinar igreja
                let igrejaTexto = '';
                if (transacao.igreja === 'inga') {
                    igrejaTexto = 'Verbo da Vida Ingá';
                } else if (transacao.igreja === 'zona-leste') {
                    igrejaTexto = 'Verbo da Vida Zona Leste';
                }
                
                tr.innerHTML = `
                    <td><span class="situacao-badge ${situacaoClass}">${situacaoTexto}</span></td>
                    <td class="amount entrada-amount">${formatarValor(transacao.valor)}</td>
                    <td>${transacao.dataHora}</td>
                    <td>${transacao.doador}</td>
                    <td><span class="tipo-doacao-badge ${tipoClass}">${tipoTexto}</span></td>
                    <td>${igrejaTexto}</td>
                    <td><span class="payment-method">${transacao.metodoPagamento}</span></td>
                    <td><span class="id-transacao">${transacao.id}</span></td>
                    <td>${transacao.observacoes || '-'}</td>
                `;
                
                tbody.appendChild(tr);
            });
            
            transactionsCount.textContent = `Mostrando ${transacoes.length} de ${allTransactions.length} doações`;
        }

        // Aplicar filtros
        function aplicarFiltros() {
            let transacoesFiltradas = [...allTransactions];
            
            // Filtro por igreja
            if (igrejaSelecionada !== 'todas') {
                transacoesFiltradas = transacoesFiltradas.filter(t => t.igreja === igrejaSelecionada);
            }
            
            // Filtro por tipo (entrada/saída)
            if (tipoSelect.value) {
                // Como todas são entradas neste exemplo, ajustar conforme necessidade
                if (tipoSelect.value === 'debit') {
                    transacoesFiltradas = []; // Não há saídas no exemplo
                }
            }
            
            // Filtro por doador
            if (doadorInput.value) {
                const termo = doadorInput.value.toLowerCase();
                transacoesFiltradas = transacoesFiltradas.filter(t => 
                    t.doador.toLowerCase().includes(termo)
                );
            }
            
            // Filtro por tipo de doação
            if (tipoDoacaoSelect.value) {
                transacoesFiltradas = transacoesFiltradas.filter(t => 
                    t.tipo === tipoDoacaoSelect.value
                );
            }
            
            // Filtro por valor mínimo
            if (valorInput.value) {
                transacoesFiltradas = transacoesFiltradas.filter(t => 
                    t.valor >= parseFloat(valorInput.value)
                );
            }
            
            // Filtro por status
            if (statusSelect.value) {
                transacoesFiltradas = transacoesFiltradas.filter(t => 
                    t.situacao === statusSelect.value
                );
            }
            
            // Filtro por método de pagamento
            if (metodoPagamentoSelect.value) {
                transacoesFiltradas = transacoesFiltradas.filter(t => 
                    t.metodoPagamento === metodoPagamentoSelect.value
                );
            }
            
            // Filtro por igreja no seletor
            if (igrejaSelect.value) {
                transacoesFiltradas = transacoesFiltradas.filter(t => 
                    t.igreja === igrejaSelect.value
                );
            }
            
            filteredTransactions = transacoesFiltradas;
            renderizarTransacoes(filteredTransactions);
            atualizarTotaisFiltrados(filteredTransactions);
        }

        // Limpar filtros
        function limparFiltros() {
            tipoSelect.value = '';
            doadorInput.value = '';
            tipoDoacaoSelect.value = '';
            valorInput.value = '';
            statusSelect.value = '';
            metodoPagamentoSelect.value = '';
            igrejaSelect.value = '';
            
            // Manter a seleção de igreja dos botões
            aplicarFiltros();
            atualizarContadores();
        }

        // Exportar dados
        function exportarDados() {
            const transacoesParaExportar = filteredTransactions.length > 0 ? filteredTransactions : allTransactions;
            
            if (transacoesParaExportar.length === 0) {
                alert('Não há dados para exportar.');
                return;
            }
            
            // Criar CSV
            let csv = 'Data,Doador,Valor,Tipo,Igreja,Método Pagamento,Status,Observações\n';
            
            transacoesParaExportar.forEach(transacao => {
                const linha = [
                    transacao.dataHora.split(' - ')[0],
                    `"${transacao.doador}"`,
                    transacao.valor.toFixed(2),
                    transacao.tipo === 'dizimo' ? 'Dízimo' : (transacao.tipo === 'oferta' ? 'Oferta' : 'Outro'),
                    transacao.igreja === 'inga' ? 'Verbo da Vida Ingá' : 'Verbo da Vida Zona Leste',
                    transacao.metodoPagamento,
                    transacao.situacao === 'approved' ? 'Aprovado' : (transacao.situacao === 'pending' ? 'Pendente' : 'Cancelado'),
                    `"${transacao.observacoes || ''}"`
                ].join(',');
                
                csv += linha + '\n';
            });
            
            // Criar e baixar arquivo
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `doacoes-verbo-da-vida-${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            alert(`Dados exportados com sucesso! ${transacoesParaExportar.length} registros.`);
        }

        // Event listeners
        aplicarFiltrosBtn.addEventListener('click', aplicarFiltros);
        limparFiltrosBtn.addEventListener('click', limparFiltros);
        atualizarDadosBtn.addEventListener('click', carregarDadosIniciais);
        exportarDadosBtn.addEventListener('click', exportarDados);

        // Seleção de igreja
        churchButtons.forEach(btn => {
            btn.addEventListener('click', function() {
                churchButtons.forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                igrejaSelecionada = this.getAttribute('data-church');
                aplicarFiltros();
            });
        });

        // Filtros dinâmicos
        doadorInput.addEventListener('input', aplicarFiltros);
        tipoSelect.addEventListener('change', aplicarFiltros);
        tipoDoacaoSelect.addEventListener('change', aplicarFiltros);
        statusSelect.addEventListener('change', aplicarFiltros);
        metodoPagamentoSelect.addEventListener('change', aplicarFiltros);
        igrejaSelect.addEventListener('change', aplicarFiltros);

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Sistema de Dízimos e Ofertas - Verbo da Vida');
            inicializarDatas();
            carregarDadosIniciais();
        });
    </script>
</body>
</html>
